# 互协方差、共谱密度、自相关系数、自谱密度
> 这里主要是介绍上面这些概念。  
> - 互协方差 - 共谱密度是一组
> - 自相关系数 - 自谱密度是一组

## 1. 自相关系数 - 自谱密度
### 1.1 一个序列的自相关系数

自相关系数是衡量一个时间序列中任意两个不同时刻取值之间相关程度的统计量。它反映了序列自身不同时间点上的数值之间的线性关联强度。具体定义如下：

对于一个平稳时间序列 {X_t, t ∈ T}，其自相关系数通常记为 ρ(τ)，其中 τ 是时间滞后（lag），表示当前时刻与过去某一时刻的时间间隔。自相关系数 ρ(τ) 在 τ = 0 时定义为 1，这是因为任何序列与其自身的即时值（即 τ = 0）完全相关。对于 τ > 0，自相关系数 ρ(τ) 可以计算为：

$$ \rho(\tau) = \frac{\gamma(\tau)}{\gamma(0)} $$

其中：
- γ(τ) 是自协方差函数，定义为序列在时间间隔 τ 上的均值中心化值的乘积的期望值：

$$ \gamma(\tau) = E[(X_t - \mu_X)(X_{t+\tau} - \mu_X)] $$
- $μ_X$ 是序列 {X_t} 的期望值（平均值）。
- γ(0) 是序列的自协方差在 τ = 0 时的值，即序列的方差：

$$ \gamma(0) = \text{Var}(X_t) $$

自相关系数的取值范围是 [-1, 1]，其中：
- ρ(τ) = 1 表示完全正相关，即序列在时间间隔 τ 处的值与当前值之间存在完美的线性关系。
- ρ(τ) = -1 表示完全负相关，即序列在时间间隔 τ 处的值与当前值之间存在完美的负线性关系。
- ρ(τ) = 0 表示不相关，即序列在时间间隔 τ 处的值与当前值之间不存在线性关联。

### 1.2 **自相关系数与自谱密度**
**自相关系数与自谱密度就是同一个序列在时域和频域的不同表示** 。可以通过先将序列变换到频域，求出自谱密度再逆变换，得到自相关系数。
快速傅里叶变换FFT）是一种高效计算离散傅里叶变换（DFT）的算法，常用于将信号从时域转换到频域。自相关系数可以通过使用FFT进行快速计算。具体步骤如下：


1. **DFT计算**：对原始序列 $X_t$ 或其预处理后的版本进行DFT（通过FFT实现），得到其频域表示 X(f)：
$$ X(f_k) = \sum_{t=0}^{N-1} X_t e^{-j2\pi f_k t / N} $$其中 N 是序列的长度，f_k 是第 k 个频率分量（k = 0, 1, ..., N-1），j 是虚数单位。


2. **频域乘积**：计算序列频域表示与其共轭的乘积，得到自相关函数的频域表示：
$$ R(f_k) = X(f_k) \cdot X^*(f_k) $$ 其中 \( X^*(f_k) \) 是 X(f_k) 的复共轭。


3. **IDFT计算**：对自相关函数的频域表示 $R(f_k)$ 进行逆离散傅里叶变换（IDFT，同样可用IFFT实现），将其转换回时域，得到自相关序列 R(τ)：
$$ R(τ_l) = \frac{1}{N} \sum_{k=0}^{N-1} R(f_k) e^{j2\pi f_k \tau_l / N} $$其中 $τ_l$ 是自相关序列中的滞后位置（l = 0, 1, ..., N-1）。注意，这里的 $R(τ_0)$ 就是自相关系数在 τ = 0 时的值，即序列的方差。


4. **标准化**：为了得到自相关系数，需将上述计算得到的自相关序列 $R(τ_l)$ 标准化，除以 $R(τ_0)$（即序列的方差），得到 自相关系数$ρ(τ_l$)：
$$ \rho(\tau_l) = \frac{R(\tau_l)}{R(\tau_0)} $$

这种方法的优点在于，FFT利用了离散傅里叶变换的性质，能够以远低于直接计算自相关函数的时间复杂度完成计算，特别适合处理长序列。在实际应用中，特别是信号处理、时间序列分析等领域，这种基于FFT的计算方法被广泛采用。

## 2. 互协方差 - 共谱密度
互协方差和共谱密度都是描述两个随机信号之间统计依赖关系的量，它们与自相关系数以及自协方差（自谱密度）有着密切的联系，并且也可以通过快速傅里叶变换（FFT）来计算或分析。下面分别介绍这两个概念及其与自相关系数和自协方差的关系：

### 2.1 **互协方差**

互协方差是衡量两个不同时间序列之间线性相关程度的统计量，类似于自协方差描述一个序列内部各时刻值的线性关联。对于两个平稳时间序列 {X_t} 和 {Y_t}，其互协方差定义为：

$$ \text{Cov}(X_t, Y_{t+\tau}) = E[(X_t - \mu_X)(Y_{t+\tau} - \mu_Y)] $$

其中：
- E[] 表示期望值运算；
- \( \mu_X \) 和 \( \mu_Y \) 分别是序列 {X_t} 和 {Y_t} 的平均值；
- τ 是时间滞后，表示当前时刻与另一序列对应时刻的时间间隔。

互协方差衡量了当一个序列在某时刻取值发生变化时，另一个序列在滞后τ时刻取值发生相应变化的趋势。若互协方差为正（负），则两个序列在该滞后下倾向于同向（反向）变化；若互协方差为零，则表明这两个序列在该滞后下没有线性相关性。

### 2.2 **共谱密度**
#### 2.2.1 共谱密度通过时域计算
共谱密度（也称为互谱密度）是互协方差函数在频域的表示，它是互相关函数（两个时间序列之间类似于自相关函数的统计量）的傅里叶变换。对于两个平稳随机过程 ${X(t)} \ {Y(t)}$，其共谱密度 Sxy(f) 定义为：

$$ S_{xy}(f) = \int_{-\infty}^{\infty} R_{xy}(\tau) e^{-j2\pi f \tau} d\tau $$

其中：
- Rxy(τ) 是 ${X(t)} \ {Y(t)} $的互相关函数；
- f 是频率；
- j 是虚数单位。

#### 2.2.2 共谱密度的频域计算
- **步骤1：将时域信号转换到频域**
    对于离散时间信号：
    $$ X[k] = \text{DFT}\{x[n]\} = \sum_{n=0}^{N-1} x[n] e^{-j2\pi kn/N} $$ $$ Y[k] = \text{DFT}\{y[n]\} = \sum_{n=0}^{N-1} y[n] e^{-j2\pi kn/N} $$其中：
    - \( \text{DFT}\{\} \) 表示离散傅里叶变换；
    - \( X[k] \) 和 \( Y[k] \) 是离散时间信号在频域的表示；
    - \( N \) 是离散时间信号的点数。

- **步骤2：计算共谱密度**
    已知两个信号在频域的表示 \( X[k] \) 和 \( Y[k] \)，可以直接计算它们的共谱密度（CSD）：$$ S_{xy}[k] = X[k] Y^*[k] $$其中：
    - \( Y^*[k] \) 表示 \( Y[k] \) 的复共轭；
    - \( S_{xy}[k] \) 是离散时间信号的共谱密度。

#### 2.2.3 共谱密度谱归一化：
对于离散时间信号，计算得到的共谱密度通常需要进行适当的归一化，归一化共谱密度（Coherence Function）：$$ C_{xy}[k] = \frac{|S_{xy}[k]|}{\sqrt{S_{xx}[k] \cdot S_{yy}[k]}} $$
其中：
    - \( S_{xy}[k] \) 是共谱密度；
    - \( S_{xx}[k] \) 和 \( S_{yy}[k] \) 分别是信号 \( X[n] \) 和 \( Y[n] \) 的功率谱密度；
    - \( |S_{xy}[k]| \) 是共谱密度的幅度值。
归一化共谱密度的值介于 0 和 1 之间，1 表示完全线性相关，0 表示无相关性。


### 2.3 **与自相关系数和自协方差的关系**

互协方差和共谱密度与自相关系数及自协方差（自谱密度）的关系体现在以下几个方面：

1. **对应关系**：
   - 自协方差是自相关系数在时域的量化形式，自谱密度则是自协方差在频域的对应物。
   - 类似地，互协方差是描述两个序列之间线性相关性的时域统计量，而共谱密度则是这一关系在频域的表述。

2. **计算方法**：
   - 自相关系数和互协方差可以通过类似的方法计算，均涉及对序列值减去各自的平均值后取乘积并求期望。
   - 自谱密度和共谱密度都可以通过快速傅里叶变换（FFT）来计算，将时域的自/互相关函数转换到频域得到自/共谱密度。

3. **物理意义**：
   - 自相关系数和自谱密度提供了一个序列内部不同时间点间或不同频率成分间的相关性信息。
   - 互协方差和共谱密度则揭示了两个不同序列之间在时域或频域上的相互影响程度。只是观察的角度不同。互协方差关注的是这种关联如何随时间滞后变化，而共谱密度则关注这种关联如何随频率分布.
   - 共谱密度提供了两个随机过程在不同频率成分上能量分布的相对关系，即在特定频率下两个过程波动的协同性。 
        - 如果两个过程在某个频率上共谱密度相位为0，说明这两个过程在该频率上同相，同大同小；
        - 反之，若共谱密度相位为$\pi$，则表明存在反相，一个大一个小。
        - 共谱密度相位为$\pi/2$代表信号正交，意味着两个信号在此频率上能量进行有序且有效的转移。此外信号传输时正交信号科研共存不干扰。

4. **应用场合**：
   - 在信号处理、通信工程、时间序列分析等领域，自相关系数和自谱密度常用来分析单个信号的特性，如周期性、趋势、自相似性等。
   - 而互协方差和共谱密度则适用于研究多个信号间的交互作用、干扰分析、滤波设计、系统识别等问题。
